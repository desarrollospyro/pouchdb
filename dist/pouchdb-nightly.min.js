!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Pouch=e()}}(function(){var define,module,exports;return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(){},{}],2:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],3:[function(e,t){"use strict";function n(e){for(var t=n.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),o={},i=14;i--;)o[t.key[i]]=r[i]||"";return o[t.q.name]={},o[t.key[12]].replace(t.q.parser,function(e,n,r){n&&(o[t.q.name][n]=r)}),o}function r(e){return/^_(design|local)/.test(e)?e:encodeURIComponent(e)}function o(e,t){if(/http(s?):/.test(e)){var r=n(e);r.remote=!0,(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var o=r.path.replace(/(^\/|\/$)/g,"").split("/");if(r.db=o.pop(),r.path=o.join("/"),t=t||{},r.headers=t.headers||{},t.auth||r.auth){var i=t.auth||r.auth,s=u.btoa(i.username+":"+i.password);r.headers.Authorization="Basic "+s}return t.headers&&(r.headers=t.headers),r}return{host:"",path:"/",db:e,auth:!1}}function i(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+e.db+"/"+t}return"/"+e.db+"/"+t}function s(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+t}return"/"+t}function a(e,t){function n(e,t){return u.ajax(u.extend({},f,e),t)}var a=o(e.name,e),d=i(a,""),l={},f=e.ajax||{},p={list:[],get:function(e,t){"function"==typeof e&&(t=e,e={count:10});var r=function(e,n){!e&&"uuids"in n?(p.list=p.list.concat(n.uuids),u.call(t,null,"OK")):u.call(t,e||c.UNKNOWN_ERROR)},o="?count="+e.count;n({headers:a.headers,method:"GET",url:s(a,"_uuids")+o},r)}},_=function(){n({headers:a.headers,method:"PUT",url:d},function(e){e&&401===e.status?n({headers:a.headers,method:"HEAD",url:d},function(e){e?u.call(t,e):u.call(t,null,l)}):e&&412!==e.status?u.call(t,c.UNKNOWN_ERROR):u.call(t,null,l)})};return e.skipSetup||n({headers:a.headers,method:"GET",url:d},function(e){e?404===e.status?_():u.call(t,e):u.call(t,null,l)}),l.type=function(){return"http"},l.id=function(){return i(a,"")},l.request=function(e,t){return l.taskqueue.ready()?(e.headers=a.headers,e.url=i(a,e.url),void n(e,t)):void l.taskqueue.addTask("request",arguments)},l.compact=function(e,t){return l.taskqueue.ready()?("function"==typeof e&&(t=e,e={}),void n({headers:a.headers,url:i(a,"_compact"),method:"POST"},function(){function n(){l.info(function(r,o){o.compact_running?setTimeout(n,e.interval||200):u.call(t,null)})}"function"==typeof t&&n()})):void l.taskqueue.addTask("compact",arguments)},l.info=function(e){return l.taskqueue.ready()?void n({headers:a.headers,method:"GET",url:i(a,"")},e):void l.taskqueue.addTask("info",arguments)},l.get=function(e,t,o){if(!l.taskqueue.ready())return void l.taskqueue.addTask("get",arguments);"function"==typeof t&&(o=t,t={}),void 0===t.auto_encode&&(t.auto_encode=!0);var s=[];t.revs&&s.push("revs=true"),t.revs_info&&s.push("revs_info=true"),t.local_seq&&s.push("local_seq=true"),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),s.push("open_revs="+t.open_revs)),t.attachments&&s.push("attachments=true"),t.rev&&s.push("rev="+t.rev),t.conflicts&&s.push("conflicts="+t.conflicts),s=s.join("&"),s=""===s?"":"?"+s,t.auto_encode&&(e=r(e));var c={headers:a.headers,method:"GET",url:i(a,e+s)},d=e.split("/");(d.length>1&&"_design"!==d[0]&&"_local"!==d[0]||d.length>2&&"_design"===d[0]&&"_local"!==d[0])&&(c.binary=!0),n(c,function(e,t,n){return e?u.call(o,e):void u.call(o,null,t,n)})},l.remove=function(e,t,o){return l.taskqueue.ready()?("function"==typeof t&&(o=t,t={}),void n({headers:a.headers,method:"DELETE",url:i(a,r(e._id))+"?rev="+e._rev},o)):void l.taskqueue.addTask("remove",arguments)},l.getAttachment=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),void 0===n.auto_encode&&(n.auto_encode=!0),n.auto_encode&&(e=r(e)),n.auto_encode=!1,l.get(e+"/"+t,n,o)},l.removeAttachment=function(e,t,o,s){return l.taskqueue.ready()?void n({headers:a.headers,method:"DELETE",url:i(a,r(e)+"/"+t)+"?rev="+o},s):void l.taskqueue.addTask("removeAttachment",arguments)},l.putAttachment=function(e,t,o,s,u,c){if(!l.taskqueue.ready())return void l.taskqueue.addTask("putAttachment",arguments);"function"==typeof u&&(c=u,u=s,s=o,o=null),"undefined"==typeof u&&(u=s,s=o,o=null);var d=r(e)+"/"+t,f=i(a,d);o&&(f+="?rev="+o);var p={headers:a.headers,method:"PUT",url:f,processData:!1,body:s,timeout:6e4};p.headers["Content-Type"]=u,n(p,c)},l.put=function(e,t,o){if(!l.taskqueue.ready())return void l.taskqueue.addTask("put",arguments);if("function"==typeof t&&(o=t,t={}),"object"!=typeof e)return u.call(o,c.NOT_AN_OBJECT);if(!("_id"in e))return u.call(o,c.MISSING_ID);var s=[];t&&"undefined"!=typeof t.new_edits&&s.push("new_edits="+t.new_edits),s=s.join("&"),""!==s&&(s="?"+s),n({headers:a.headers,method:"PUT",url:i(a,r(e._id))+s,body:e},o)},l.post=function(e,t,n){return l.taskqueue.ready()?("function"==typeof t&&(n=t,t={}),"object"!=typeof e?u.call(n,c.NOT_AN_OBJECT):void("_id"in e?l.put(e,t,n):p.list.length>0?(e._id=p.list.pop(),l.put(e,t,n)):p.get(function(r){return r?u.call(n,c.UNKNOWN_ERROR):(e._id=p.list.pop(),void l.put(e,t,n))}))):void l.taskqueue.addTask("post",arguments)},l.bulkDocs=function(e,t,r){return l.taskqueue.ready()?("function"==typeof t&&(r=t,t={}),t||(t={}),"undefined"!=typeof t.new_edits&&(e.new_edits=t.new_edits),void n({headers:a.headers,method:"POST",url:i(a,"_bulk_docs"),body:e},r)):void l.taskqueue.addTask("bulkDocs",arguments)},l.allDocs=function(e,t){if(!l.taskqueue.ready())return void l.taskqueue.addTask("allDocs",arguments);"function"==typeof e&&(t=e,e={});var r,o=[],s="GET";e.conflicts&&o.push("conflicts=true"),e.descending&&o.push("descending=true"),e.include_docs&&o.push("include_docs=true"),e.startkey&&o.push("startkey="+encodeURIComponent(JSON.stringify(e.startkey))),e.endkey&&o.push("endkey="+encodeURIComponent(JSON.stringify(e.endkey))),e.limit&&o.push("limit="+e.limit),"undefined"!=typeof e.skip&&o.push("skip="+e.skip),o=o.join("&"),""!==o&&(o="?"+o),"undefined"!=typeof e.keys&&(s="POST",r=JSON.stringify({keys:e.keys})),n({headers:a.headers,method:s,url:i(a,"_all_docs"+o),body:r},t)},l.changes=function(e){var t=25;if(!l.taskqueue.ready()){var r=l.taskqueue.addTask("changes",arguments);return{cancel:function(){return r.task?r.task.cancel():void(r.parameters[0].aborted=!0)}}}if("latest"===e.since){var o;return l.info(function(t,n){e.aborted||(e.since=n.update_seq,o=l.changes(e))}),{cancel:function(){return o?o.cancel():void(e.aborted=!0)}}}var s={},d="undefined"!=typeof e.limit?e.limit:!1;0===d&&(d=1);var f=d;if(e.style&&(s.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(s.include_docs=!0),e.continuous&&(s.feed="longpoll"),e.conflicts&&(s.conflicts=!0),e.descending&&(s.descending=!0),e.filter&&"string"==typeof e.filter&&(s.filter=e.filter),e.query_params&&"object"==typeof e.query_params)for(var p in e.query_params)e.query_params.hasOwnProperty(p)&&(s[p]=e.query_params[p]);var _,h,v,m,g=function(r,o){s.since=r,e.continuous||m||(m=v),s.limit=!d||f>t?t:f;var u="?"+Object.keys(s).map(function(e){return e+"="+s[e]}).join("&"),c={headers:a.headers,method:"GET",url:i(a,"_changes"+u),timeout:null};h=r,e.aborted||(_=n(c,o))},y=10,S=0,E={results:[]},b=function(n,r){if(r&&r.results){E.last_seq=r.last_seq;var o={};o.query=e.query_params,r.results=r.results.filter(function(t){f--;var n=u.filterChange(e)(t);return n&&(E.results.push(t),u.call(e.onChange,t)),n})}r&&r.last_seq&&(h=r.last_seq);var i=r&&r.results.length||0;m-=t;var s=d&&0>=f||r&&!i&&0>=m||i&&r.last_seq===v||e.descending&&0!==h;if(e.continuous||!s){n?S+=1:S=0;var a=1<<S,l=y*a,p=e.maximumWait||3e4;l>p&&u.call(e.complete,n||c.UNKNOWN_ERROR,null),setTimeout(function(){g(h,b)},l)}else u.call(e.complete,null,E)};return e.continuous?g(e.since||0,b):l.info(function(t,n){return t?u.call(e.complete,t):(v=n.update_seq,void g(e.since||0,b))}),{cancel:function(){e.aborted=!0,_.abort()}}},l.revsDiff=function(e,t,r){return l.taskqueue.ready()?("function"==typeof t&&(r=t,t={}),void n({headers:a.headers,method:"POST",url:i(a,"_revs_diff"),body:e},function(e,t){u.call(r,e,t)})):void l.taskqueue.addTask("revsDiff",arguments)},l.close=function(e){return l.taskqueue.ready()?void u.call(e,null):void l.taskqueue.addTask("close",arguments)},l.replicateOnServer=function(e,r,i){if(!l.taskqueue.ready())return l.taskqueue.addTask("replicateOnServer",arguments),i;var s=o(e.id()),c={source:a.db,target:s.protocol===a.protocol&&s.authority===a.authority?s.db:s.source};r.continuous&&(c.continuous=!0),r.create_target&&(c.create_target=!0),r.doc_ids&&(c.doc_ids=r.doc_ids),r.filter&&"string"==typeof r.filter&&(c.filter=r.filter),r.query_params&&(c.query_params=r.query_params);var d,f={},p={headers:a.headers,method:"POST",url:a.protocol+"://"+a.host+(80===a.port?"":":"+a.port)+"/_replicate",body:c};i.cancel=function(){this.cancelled=!0,d&&!f.ok&&d.abort(),f._local_id&&(p.body={replication_id:f._local_id}),p.body.cancel=!0,n(p,function(e,n,o){return e?u.call(t,e):void u.call(r.complete,null,f,o)})},i.cancelled||(d=n(p,function(e,n,o){return e?u.call(t,e):(f.ok=!0,n._local_id&&(f._local_id=n._local_id),void u.call(r.complete,null,n,o))}))},l}var u=(e("../pouch.js"),e("../pouch.utils.js")),c=e("../deps/errors");n.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},a.destroy=function(e,t,n){var r=o(e,t);t=t||{},"function"==typeof t&&(n=t,t={}),t.headers=r.headers,t.method="DELETE",t.url=i(r,""),u.ajax(t,n)},a.valid=function(){return!0},t.exports=a},{"../deps/errors":8,"../pouch.js":15,"../pouch.utils.js":18}],4:[function(_dereq_,module,exports){"use strict";function idbError(e){return function(t){PouchUtils.call(e,{status:500,error:t.type,reason:t.target})}}function IdbPouch(opts,callback){function createSchema(e){e.createObjectStore(DOC_STORE,{keyPath:"id"}).createIndex("seq","seq",{unique:!0}),e.createObjectStore(BY_SEQ_STORE,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(ATTACH_STORE,{keyPath:"digest"}),e.createObjectStore(META_STORE,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(DETECT_BLOB_SUPPORT_STORE)}function fixBinary(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;t>o;o++)r[o]=e.charCodeAt(o);return n}function sortByBulkSeq(e,t){return e._bulk_seq-t._bulk_seq}var POUCH_VERSION=1,DOC_STORE="document-store",BY_SEQ_STORE="by-sequence",ATTACH_STORE="attach-store",META_STORE="meta-store",DETECT_BLOB_SUPPORT_STORE="detect-blob-support",name=opts.name,req=window.indexedDB.open(name,POUCH_VERSION);"openReqList"in IdbPouch||(IdbPouch.openReqList={}),IdbPouch.openReqList[name]=req;var blobSupport=null,instanceId=null,api={},idb=null;return req.onupgradeneeded=function(e){for(var t=e.target.result,n=e.oldVersion;n!==e.newVersion;)0===n&&createSchema(t),n++},req.onsuccess=function(e){idb=e.target.result;var t=idb.transaction([META_STORE,DETECT_BLOB_SUPPORT_STORE],"readwrite");if(idb.onversionchange=function(){idb.close()},idb.setVersion&&Number(idb.version)!==POUCH_VERSION){var n=idb.setVersion(POUCH_VERSION);return void(n.onsuccess=function(t){function n(){r.onsuccess(e)}t.target.result.oncomplete=n,r.onupgradeneeded(e)})}var r=t.objectStore(META_STORE).get(META_STORE);r.onsuccess=function(e){var n=e.target.result||{id:META_STORE};name+"_id"in n?instanceId=n[name+"_id"]:(instanceId=PouchUtils.uuid(),n[name+"_id"]=instanceId,t.objectStore(META_STORE).put(n));try{t.objectStore(DETECT_BLOB_SUPPORT_STORE).put(PouchUtils.createBlob(),"key"),blobSupport=!0}catch(r){blobSupport=!1}finally{PouchUtils.call(callback,null,api)}}},req.onerror=idbError(callback),api.type=function(){return"idb"},api.id=function(){return instanceId},api._bulkDocs=function(e,t,n){function r(e){var t=e.target.result;t.updateSeq=(t.updateSeq||0)+y,m.objectStore(META_STORE).put(t)}function o(){if(!h.length)return void(m.objectStore(META_STORE).get(META_STORE).onsuccess=r);var e=h.shift(),t=m.objectStore(DOC_STORE).get(e.metadata.id);t.onsuccess=function(t){var n=t.target.result;n?c(n,e):d(e)}}function i(){var e=[];g.sort(sortByBulkSeq),g.forEach(function(t){if(delete t._bulk_seq,t.error)return void e.push(t);var n=t.metadata,r=PouchMerge.winningRev(n);e.push({ok:!0,id:n.id,rev:r}),PouchUtils.isLocalId(n.id)||(IdbPouch.Changes.notify(name),IdbPouch.Changes.notifyLocalWindows(name))}),PouchUtils.call(n,null,e)}function s(e,t){if(e.stub)return t();if("string"==typeof e.data){var r;try{r=atob(e.data)}catch(o){var i=PouchUtils.error(errors.BAD_ARG,"Attachments need to be base64 encoded");return PouchUtils.call(n,i)}if(e.digest="md5-"+PouchUtils.Crypto.MD5(r),blobSupport){var s=e.content_type;r=fixBinary(r),e.data=PouchUtils.createBlob([r],{type:s})}return t()}var a=new FileReader;a.onloadend=function(){e.digest="md5-"+PouchUtils.Crypto.MD5(this.result),blobSupport||(e.data=btoa(this.result)),t()},a.readAsBinaryString(e.data)}function a(e){function t(){n++,h.length===n&&e()}if(!h.length)return e();var n=0;h.forEach(function(e){function n(){o++,o===r.length&&t()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!r.length)return t();var o=0;for(var i in e.data._attachments)s(e.data._attachments[i],n)})}function u(e,t){function n(e){i||(e?(i=e,PouchUtils.call(t,i)):s===a.length&&o())}function r(e){s++,n(e)}function o(){e.data._doc_id_rev=e.data._id+"::"+e.data._rev;var n=m.objectStore(BY_SEQ_STORE).put(e.data);n.onsuccess=function(n){e.metadata.seq=n.target.result,delete e.metadata.rev;var r=m.objectStore(DOC_STORE).put(e.metadata);r.onsuccess=function(){g.push(e),PouchUtils.call(t)}}}var i=null,s=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,y++,PouchUtils.isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var a=e.data._attachments?Object.keys(e.data._attachments):[];for(var u in e.data._attachments)if(e.data._attachments[u].stub)s++,n();else{var c=e.data._attachments[u].data;delete e.data._attachments[u].data;var d=e.data._attachments[u].digest;f(e,d,c,r)}a.length||o()}function c(e,t){var n=PouchMerge.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=PouchUtils.isDeleted(e),i=r&&PouchUtils.isDeleted(t.metadata)||!r&&p&&"new_leaf"!==n.conflicts;return i?(g.push(l(errors.REV_CONFLICT,t._bulk_seq)),o()):(t.metadata.rev_tree=n.tree,void u(t,o))}function d(e){return"was_delete"in t&&PouchUtils.isDeleted(e.metadata)?(g.push(errors.MISSING_DOC),o()):void u(e,o)}function l(e,t){return e._bulk_seq=t,e}function f(e,t,n,r){{var o=m.objectStore(ATTACH_STORE);o.get(t).onsuccess=function(i){var s=i.target.result&&i.target.result.refs||{},a=[e.metadata.id,e.metadata.rev].join("@"),u={digest:t,body:n,refs:s};u.refs[a]=!0;o.put(u).onsuccess=function(){PouchUtils.call(r)}}}}var p=t.new_edits,_=e.docs,h=_.map(function(e,t){var n=PouchUtils.parseDoc(e,p);return n._bulk_seq=t,n}),v=h.filter(function(e){return e.error});if(v.length)return PouchUtils.call(n,v[0]);var m,g=[],y=0;a(function(){m=idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,META_STORE],"readwrite"),m.onerror=idbError(n),m.ontimeout=idbError(n),m.oncomplete=i,o()})},api._get=function(e,t,n){function r(){PouchUtils.call(n,s,{doc:o,metadata:i,ctx:a})}var o,i,s,a;a=t.ctx?t.ctx:idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly"),a.objectStore(DOC_STORE).get(e).onsuccess=function(e){if(i=e.target.result,!i)return s=errors.MISSING_DOC,r();if(PouchUtils.isDeleted(i)&&!t.rev)return s=PouchUtils.error(errors.MISSING_DOC,"deleted"),r();var n=PouchMerge.winningRev(i),u=i.id+"::"+(t.rev?t.rev:n),c=a.objectStore(BY_SEQ_STORE).index("_doc_id_rev");c.get(u).onsuccess=function(e){return o=e.target.result,o&&o._doc_id_rev&&delete o._doc_id_rev,o?void r():(s=errors.MISSING_DOC,r())}}},api._getAttachment=function(e,t,n){var r,o;o=t.ctx?t.ctx:idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");var i=e.digest,s=e.content_type;o.objectStore(ATTACH_STORE).get(i).onsuccess=function(e){var o=e.target.result.body;if(t.encode)if(blobSupport){var i=new FileReader;i.onloadend=function(){r=btoa(this.result),PouchUtils.call(n,null,r)},i.readAsBinaryString(o)}else r=o,PouchUtils.call(n,null,r);else blobSupport?r=o:(o=fixBinary(atob(o)),r=PouchUtils.createBlob([o],{type:s})),PouchUtils.call(n,null,r)}},api._allDocs=function(e,t){var n="startkey"in e?e.startkey:!1,r="endkey"in e?e.endkey:!1,o="descending"in e?e.descending:!1;o=o?"prev":null;var i=n&&r?window.IDBKeyRange.bound(n,r):n?window.IDBKeyRange.lowerBound(n):r?window.IDBKeyRange.upperBound(r):null,s=idb.transaction([DOC_STORE,BY_SEQ_STORE],"readonly");s.oncomplete=function(){"keys"in e&&(e.keys.forEach(function(e){c.push(e in d?d[e]:{key:e,error:"not_found"})}),e.descending&&c.reverse()),PouchUtils.call(t,null,{total_rows:c.length,offset:e.skip,rows:"limit"in e?c.slice(e.skip,e.limit+e.skip):e.skip>0?c.slice(e.skip):c})};var a=s.objectStore(DOC_STORE),u=o?a.openCursor(i,o):a.openCursor(i),c=[],d={};u.onsuccess=function(t){function n(t,n){if(PouchUtils.isLocalId(t.id))return r["continue"]();var o={id:t.id,key:t.id,value:{rev:PouchMerge.winningRev(t)}};if(e.include_docs){o.doc=n,o.doc._rev=PouchMerge.winningRev(t),o.doc._doc_id_rev&&delete o.doc._doc_id_rev,e.conflicts&&(o.doc._conflicts=PouchMerge.collectConflicts(t));for(var i in o.doc._attachments)o.doc._attachments[i].stub=!0}"keys"in e?e.keys.indexOf(t.id)>-1&&(PouchUtils.isDeleted(t)&&(o.value.deleted=!0,o.doc=null),d[o.id]=o):PouchUtils.isDeleted(t)||c.push(o),r["continue"]()}if(t.target.result){var r=t.target.result,o=r.value;if(e.include_docs){var i=s.objectStore(BY_SEQ_STORE).index("_doc_id_rev"),a=PouchMerge.winningRev(o),u=o.id+"::"+a;i.get(u).onsuccess=function(e){n(r.value,e.target.result)}}else n(o)}}},api._info=function(e){function t(e){o=e.target.result&&e.target.result.updateSeq||0}function n(e){var n=e.target.result;return n?(n.value.deleted!==!0&&r++,void n["continue"]()):void(i.objectStore(META_STORE).get(META_STORE).onsuccess=t)}var r=0,o=0,i=idb.transaction([DOC_STORE,META_STORE],"readonly");i.oncomplete=function(){e(null,{db_name:name,doc_count:r,update_seq:o})},i.objectStore(DOC_STORE).openCursor().onsuccess=n},api._changes=function idb_changes(opts){function fetchChanges(){txn=idb.transaction([DOC_STORE,BY_SEQ_STORE]),txn.oncomplete=onTxnComplete;var e;e=descending?txn.objectStore(BY_SEQ_STORE).openCursor(window.IDBKeyRange.lowerBound(opts.since,!0),descending):txn.objectStore(BY_SEQ_STORE).openCursor(window.IDBKeyRange.lowerBound(opts.since,!0)),e.onsuccess=onsuccess,e.onerror=onerror}function onsuccess(e){if(!e.target.result){for(var t=0,n=results.length;n>t;t++){var r=results[t];r&&dedupResults.push(r)}return!1}var o=e.target.result,i=o.value._id,s=resultIndices[i];if(void 0!==s)return results[s].seq=o.key,results.push(results[s]),results[s]=null,resultIndices[i]=results.length-1,o["continue"]();var a=txn.objectStore(DOC_STORE);a.get(o.value._id).onsuccess=function(e){var t=e.target.result;if(PouchUtils.isLocalId(t.id))return o["continue"]();last_seq<t.seq&&(last_seq=t.seq);var n=PouchMerge.winningRev(t),r=t.id+"::"+n,i=txn.objectStore(BY_SEQ_STORE).index("_doc_id_rev");i.get(r).onsuccess=function(e){var r=e.target.result;delete r._doc_id_rev;var i=[{rev:n}];"all_docs"===opts.style&&(i=PouchMerge.collectLeaves(t.rev_tree).map(function(e){return{rev:e.rev}}));var s={id:t.id,seq:o.key,changes:i,doc:r};PouchUtils.isDeleted(t,n)&&(s.deleted=!0),opts.conflicts&&(s.doc._conflicts=PouchMerge.collectConflicts(t));var a=s.id,u=resultIndices[a];void 0!==u&&(results[u]=null),results.push(s),resultIndices[a]=results.length-1,o["continue"]()}}}function onTxnComplete(){PouchUtils.processChanges(opts,dedupResults,last_seq)}function onerror(){PouchUtils.call(opts.complete)}if(opts.continuous){var id=name+":"+PouchUtils.uuid();return opts.cancelled=!1,IdbPouch.Changes.addListener(name,id,api,opts),IdbPouch.Changes.notify(name),{cancel:function(){opts.cancelled=!0,IdbPouch.Changes.removeListener(name,id)}}}var descending=opts.descending?"prev":null,last_seq=0;opts.since=opts.since&&!descending?opts.since:0;var results=[],resultIndices={},dedupResults=[],txn;if(opts.filter&&"string"==typeof opts.filter){var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){var filter=eval("(function () { return "+ddoc.filters[filterName[1]]+" })()");opts.filter=filter,fetchChanges()})}else fetchChanges()},api._close=function(e){return null===idb?PouchUtils.call(e,errors.NOT_OPEN):(idb.close(),void PouchUtils.call(e,null))},api._getRevisionTree=function(e,t){var n=idb.transaction([DOC_STORE],"readonly"),r=n.objectStore(DOC_STORE).get(e);r.onsuccess=function(e){var n=e.target.result;n?PouchUtils.call(t,null,n.rev_tree):PouchUtils.call(t,errors.MISSING_DOC)}},api._doCompaction=function(e,t,n,r){var o=idb.transaction([DOC_STORE,BY_SEQ_STORE],"readwrite"),i=o.objectStore(DOC_STORE);i.get(e).onsuccess=function(r){var i=r.target.result;i.rev_tree=t;var s=n.length;n.forEach(function(t){var n=o.objectStore(BY_SEQ_STORE).index("_doc_id_rev"),r=e+"::"+t;n.getKey(r).onsuccess=function(e){var t=e.target.result;if(t){{o.objectStore(BY_SEQ_STORE)["delete"](t)}s--,s||o.objectStore(DOC_STORE).put(i)}}})},o.oncomplete=function(){PouchUtils.call(r)}},api}var PouchUtils=_dereq_("../pouch.utils.js"),PouchMerge=_dereq_("../pouch.merge"),errors=_dereq_("../deps/errors");IdbPouch.valid=function(){return"undefined"!=typeof window&&!!window.indexedDB},IdbPouch.destroy=function(e,t,n){"openReqList"in IdbPouch||(IdbPouch.openReqList={}),IdbPouch.Changes.clearListeners(e),IdbPouch.openReqList[e]&&IdbPouch.openReqList[e].result&&IdbPouch.openReqList[e].result.close();var r=window.indexedDB.deleteDatabase(e);r.onsuccess=function(){IdbPouch.openReqList[e]&&(IdbPouch.openReqList[e]=null),PouchUtils.call(n,null)},r.onerror=idbError(n)},IdbPouch.Changes=new PouchUtils.Changes,module.exports=IdbPouch},{"../deps/errors":8,"../pouch.merge":16,"../pouch.utils.js":18}],5:[function(_dereq_,module,exports){"use strict";function quote(e){return"'"+e+"'"}function unknownError(e){return function(t){PouchUtils.call(e,{status:500,error:t.type,reason:t.target})}}function webSqlPouch(opts,callback){function dbCreated(){callback(null,api)}function setup(){db.transaction(function(e){var t="CREATE TABLE IF NOT EXISTS "+META_STORE+" (update_seq, dbid)",n="CREATE TABLE IF NOT EXISTS "+ATTACH_STORE+" (digest, json, body BLOB)",r="CREATE TABLE IF NOT EXISTS "+DOC_STORE+" (id unique, seq, json, winningseq)",o="CREATE TABLE IF NOT EXISTS "+BY_SEQ_STORE+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, doc_id_rev UNIQUE, json)";e.executeSql(n),e.executeSql(r),e.executeSql(o),e.executeSql(t);var i="SELECT update_seq FROM "+META_STORE;e.executeSql(i,[],function(e,t){if(!t.rows.length){var n="INSERT INTO "+META_STORE+" (update_seq) VALUES (?)";return void e.executeSql(n,[0])}});var s="SELECT dbid FROM "+META_STORE+" WHERE dbid IS NOT NULL";e.executeSql(s,[],function(e,t){if(!t.rows.length){var n="UPDATE "+META_STORE+" SET dbid=?";return instanceId=PouchUtils.uuid(),void e.executeSql(n,[instanceId])}instanceId=t.rows.item(0).dbid})},unknownError(callback),dbCreated)}function makeRevs(e){return e.map(function(e){return{rev:e.rev}})}var api={},instanceId=null,name=opts.name,db=openDatabase(name,POUCH_VERSION,name,POUCH_SIZE);return db?(PouchUtils.isCordova()&&"undefined"!=typeof window?window.addEventListener(name+"_pouch",function e(){window.removeEventListener(name+"_pouch",e,!1),setup()},!1):setup(),api.type=function(){return"websql"},api.id=function(){return instanceId},api._info=function(e){db.transaction(function(t){var n="SELECT COUNT(id) AS count FROM "+DOC_STORE;t.executeSql(n,[],function(t,n){var r=n.rows.item(0).count,o="SELECT update_seq FROM "+META_STORE;t.executeSql(o,[],function(t,n){var o=n.rows.item(0).update_seq;e(null,{db_name:name,doc_count:r,update_seq:o})})})})},api._bulkDocs=function(e,t,n){function r(e,t){return e._bulk_seq-t._bulk_seq}function o(){var e=[];S.sort(r),S.forEach(function(t){if(delete t._bulk_seq,t.error)return void e.push(t);var n=t.metadata,r=PouchMerge.winningRev(n);e.push({ok:!0,id:n.id,rev:r}),PouchUtils.isLocalId(n.id)||(v++,webSqlPouch.Changes.notify(name),webSqlPouch.Changes.notifyLocalWindows(name))});var t="SELECT update_seq FROM "+META_STORE;y.executeSql(t,[],function(t,r){var o=r.rows.item(0).update_seq+v,i="UPDATE "+META_STORE+" SET update_seq=?";t.executeSql(i,[o],function(){PouchUtils.call(n,null,e)})})}function i(e,t){if(e.stub)return t();if("string"==typeof e.data){try{e.data=atob(e.data)}catch(r){var o=PouchUtils.error(errors.BAD_ARG,"Attachments need to be base64 encoded");return PouchUtils.call(n,o)}return e.digest="md5-"+PouchUtils.Crypto.MD5(e.data),t()}var i=new FileReader;i.onloadend=function(){e.data=this.result,e.digest="md5-"+PouchUtils.Crypto.MD5(this.result),t()},i.readAsBinaryString(e.data)}function s(e){function t(){n++,m.length===n&&e()}if(!m.length)return e();var n=0,r=0;m.forEach(function(e){function n(){r++,r===o.length&&t()}var o=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!o.length)return t();for(var s in e.data._attachments)i(e.data._attachments[s],n)})}function a(e,t,n){function r(){var t=e.data,n="INSERT INTO "+BY_SEQ_STORE+" (doc_id_rev, json) VALUES (?, ?);";y.executeSql(n,[t._id+"::"+t._rev,JSON.stringify(t)],s)}function o(e){a||(e?(a=e,PouchUtils.call(t,a)):u===c.length&&r())}function i(e){u++,o(e)}function s(r,o){var i=e.metadata.seq=o.insertId;delete e.metadata.rev;var s=PouchMerge.winningRev(e.metadata),a=n?"UPDATE "+DOC_STORE+" SET seq=?, json=?, winningseq=(SELECT seq FROM "+BY_SEQ_STORE+" WHERE doc_id_rev=?) WHERE id=?":"INSERT INTO "+DOC_STORE+" (id, seq, winningseq, json) VALUES (?, ?, ?, ?);",u=JSON.stringify(e.metadata),c=e.metadata.id+"::"+s,d=n?[i,u,c,e.metadata.id]:[e.metadata.id,i,i,u];r.executeSql(a,d,function(){S.push(e),PouchUtils.call(t,null)})}var a=null,u=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,PouchUtils.isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var c=e.data._attachments?Object.keys(e.data._attachments):[];for(var d in e.data._attachments)if(e.data._attachments[d].stub)u++,o();else{var l=e.data._attachments[d].data;delete e.data._attachments[d].data;var p=e.data._attachments[d].digest;f(e,p,l,i)}c.length||r()}function u(e,t){var n=PouchMerge.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=PouchUtils.isDeleted(e)&&PouchUtils.isDeleted(t.metadata)||!PouchUtils.isDeleted(e)&&_&&"new_leaf"!==n.conflicts;return r?(S.push(l(errors.REV_CONFLICT,t._bulk_seq)),d()):(t.metadata.rev_tree=n.tree,void a(t,d,!0))}function c(e){return"was_delete"in t&&PouchUtils.isDeleted(e.metadata)?(S.push(errors.MISSING_DOC),d()):void a(e,d,!1)}function d(){if(!m.length)return o();var e=m.shift(),t=e.metadata.id;t in E?u(E[t],e):(E[t]=e.metadata,c(e))}function l(e,t){return e._bulk_seq=t,e}function f(e,t,n,r){var o=[e.metadata.id,e.metadata.rev].join("@"),i={digest:t},s="SELECT digest, json FROM "+ATTACH_STORE+" WHERE digest=?";y.executeSql(s,[t],function(e,a){a.rows.length?(i.refs=JSON.parse(a.rows.item(0).json).refs,s="UPDATE "+ATTACH_STORE+" SET json=?, body=? WHERE digest=?",e.executeSql(s,[JSON.stringify(i),n,t],function(){PouchUtils.call(r,null)})):(i.refs={},i.refs[o]=!0,s="INSERT INTO "+ATTACH_STORE+"(digest, json, body) VALUES (?, ?, ?)",e.executeSql(s,[t,JSON.stringify(i),n],function(){PouchUtils.call(r,null)}))})}function p(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n);E[r.id]=JSON.parse(r.json)}d()}var _=t.new_edits,h=e.docs,v=0,m=h.map(function(e,t){var n=PouchUtils.parseDoc(e,_);return n._bulk_seq=t,n}),g=m.filter(function(e){return e.error});if(g.length)return PouchUtils.call(n,g[0]);var y,S=[],E={};s(function(){db.transaction(function(e){y=e;var t="("+m.map(function(e){return quote(e.metadata.id)}).join(",")+")",n="SELECT * FROM "+DOC_STORE+" WHERE id IN "+t;y.executeSql(n,[],p)},unknownError(n))})},api._get=function(e,t,n){function r(){PouchUtils.call(n,s,{doc:o,metadata:i,ctx:a})}var o,i,s;if(!t.ctx)return void db.transaction(function(r){t.ctx=r,api._get(e,t,n)});var a=t.ctx,u="SELECT * FROM "+DOC_STORE+" WHERE id=?";a.executeSql(u,[e],function(e,n){if(!n.rows.length)return s=errors.MISSING_DOC,r();if(i=JSON.parse(n.rows.item(0).json),PouchUtils.isDeleted(i)&&!t.rev)return s=PouchUtils.error(errors.MISSING_DOC,"deleted"),r();var u=PouchMerge.winningRev(i),c=t.rev?t.rev:u;c=i.id+"::"+c;var d="SELECT * FROM "+BY_SEQ_STORE+" WHERE doc_id_rev=?";a.executeSql(d,[c],function(e,t){return t.rows.length?(o=JSON.parse(t.rows.item(0).json),void r()):(s=errors.MISSING_DOC,r())})})},api._allDocs=function(e,t){var n=[],r={},o="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,s="descending"in e?e.descending:!1,a="SELECT "+DOC_STORE+".id, "+BY_SEQ_STORE+".seq, "+BY_SEQ_STORE+".json AS data, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq";"keys"in e?a+=" WHERE "+DOC_STORE+".id IN ("+e.keys.map(function(e){return quote(e)}).join(",")+")":(o&&(a+=" WHERE "+DOC_STORE+'.id >= "'+o+'"'),i&&(a+=(o?" AND ":" WHERE ")+DOC_STORE+'.id <= "'+i+'"'),a+=" ORDER BY "+DOC_STORE+".id "+(s?"DESC":"ASC")),db.transaction(function(t){t.executeSql(a,[],function(t,o){for(var i=0,s=o.rows.length;s>i;i++){var a=o.rows.item(i),u=JSON.parse(a.metadata),c=JSON.parse(a.data);if(!PouchUtils.isLocalId(u.id)){if(a={id:u.id,key:u.id,value:{rev:PouchMerge.winningRev(u)}},e.include_docs){a.doc=c,a.doc._rev=PouchMerge.winningRev(u),e.conflicts&&(a.doc._conflicts=PouchMerge.collectConflicts(u));for(var d in a.doc._attachments)a.doc._attachments[d].stub=!0}"keys"in e?e.keys.indexOf(u.id)>-1&&(PouchUtils.isDeleted(u)&&(a.value.deleted=!0,a.doc=null),r[a.id]=a):PouchUtils.isDeleted(u)||n.push(a)}}})},unknownError(t),function(){"keys"in e&&(e.keys.forEach(function(e){n.push(e in r?r[e]:{key:e,error:"not_found"})}),e.descending&&n.reverse()),PouchUtils.call(t,null,{total_rows:n.length,offset:e.skip,rows:"limit"in e?n.slice(e.skip,e.limit+e.skip):e.skip>0?n.slice(e.skip):n})})},api._changes=function idb_changes(opts){function fetchChanges(){var e="SELECT "+DOC_STORE+".id, "+BY_SEQ_STORE+".seq, "+BY_SEQ_STORE+".json AS data, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq WHERE "+DOC_STORE+".seq > "+opts.since+" ORDER BY "+DOC_STORE+".seq "+(descending?"DESC":"ASC");
db.transaction(function(t){t.executeSql(e,[],function(e,t){for(var n=0,r=0,o=t.rows.length;o>r;r++){var i=t.rows.item(r),s=JSON.parse(i.metadata);if(!PouchUtils.isLocalId(s.id)){n<i.seq&&(n=i.seq);var a=JSON.parse(i.data),u=a._rev,c=[{rev:u}];"all_docs"===opts.style&&(c=makeRevs(PouchMerge.collectLeaves(s.rev_tree)));var d={id:s.id,seq:i.seq,changes:c,doc:a};PouchUtils.isDeleted(s,u)&&(d.deleted=!0),opts.conflicts&&(d.doc._conflicts=PouchMerge.collectConflicts(s)),results.push(d)}}PouchUtils.processChanges(opts,results,n)})})}if(opts.continuous){var id=name+":"+PouchUtils.uuid();return opts.cancelled=!1,webSqlPouch.Changes.addListener(name,id,api,opts),webSqlPouch.Changes.notify(name),{cancel:function(){opts.cancelled=!0,webSqlPouch.Changes.removeListener(name,id)}}}var descending=opts.descending;opts.since=opts.since&&!descending?opts.since:0;var results=[],txn;if(opts.filter&&"string"==typeof opts.filter){var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){var filter=eval("(function () { return "+ddoc.filters[filterName[1]]+" })()");opts.filter=filter,fetchChanges()})}else fetchChanges()},api._close=function(e){PouchUtils.call(e,null)},api._getAttachment=function(e,t,n){var r,o=t.ctx,i=e.digest,s=e.content_type,a="SELECT body FROM "+ATTACH_STORE+" WHERE digest=?";o.executeSql(a,[i],function(e,o){var i=o.rows.item(0).body;r=t.encode?btoa(i):PouchUtils.createBlob([i],{type:s}),PouchUtils.call(n,null,r)})},api._getRevisionTree=function(e,t){db.transaction(function(n){var r="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";n.executeSql(r,[e],function(e,n){if(n.rows.length){var r=JSON.parse(n.rows.item(0).metadata);PouchUtils.call(t,null,r.rev_tree)}else PouchUtils.call(t,errors.MISSING_DOC)})})},api._doCompaction=function(e,t,n,r){db.transaction(function(o){var i="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";o.executeSql(i,[e],function(o,i){if(!i.rows.length)return PouchUtils.call(r);var s=JSON.parse(i.rows.item(0).metadata);s.rev_tree=t;var a="DELETE FROM "+BY_SEQ_STORE+" WHERE doc_id_rev IN ("+n.map(function(t){return quote(e+"::"+t)}).join(",")+")";o.executeSql(a,[],function(t){var n="UPDATE "+DOC_STORE+" SET json = ? WHERE id = ?";t.executeSql(n,[JSON.stringify(s),e],function(){r()})})})})},api):PouchUtils.call(callback,errors.UNKNOWN_ERROR)}var PouchUtils=_dereq_("../pouch.utils.js"),PouchMerge=_dereq_("../pouch.merge"),errors=_dereq_("../deps/errors"),POUCH_VERSION=1,POUCH_SIZE=5242880,DOC_STORE=quote("document-store"),BY_SEQ_STORE=quote("by-sequence"),ATTACH_STORE=quote("attach-store"),META_STORE=quote("metadata-store");webSqlPouch.valid=function(){return"undefined"!=typeof window&&!!window.openDatabase},webSqlPouch.destroy=function(e,t,n){var r=openDatabase(e,POUCH_VERSION,e,POUCH_SIZE);r.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS "+DOC_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+BY_SEQ_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+ATTACH_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+META_STORE,[])},unknownError(n),function(){PouchUtils.call(n,null)})},webSqlPouch.Changes=new PouchUtils.Changes,module.exports=webSqlPouch},{"../deps/errors":8,"../pouch.merge":16,"../pouch.utils.js":18}],6:[function(e,t){function n(e,t){function n(e){var t=Array.prototype.slice.call(arguments,1);typeof e==typeof Function&&e.apply(this,t)}function s(t,r,o){if(e.binary||e.json||!e.processData||"string"==typeof t){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(i){return void n(o,i)}}else t=JSON.stringify(t);n(o,null,t,r)}function a(e,t){var r,i={status:e.status};try{r=JSON.parse(e.responseText),i=o(!0,{},i,r)}catch(s){}n(t,i)}function u(e,t,n){if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3);var o="; expires="+r.toGMTString()}else var o="";document.cookie=e+"="+t+o+"; path=/"}function c(){f=!0,p.abort(),n(a,p,t)}"function"==typeof e&&(t=e,e={});var d={method:"GET",headers:{},json:!0,processData:!0,timeout:6e4};if(e=o(!0,d,e),"undefined"!=typeof window&&window.XMLHttpRequest){var l,f=!1,p=new XMLHttpRequest;p.open(e.method,e.url),p.withCredentials=!0,e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(p.responseType="arraybuffer");for(var _ in e.headers)if("Cookie"===_){var h=e.headers[_].split("=");u(h[0],h[1],10)}else p.setRequestHeader(_,e.headers[_]);return"body"in e||(e.body=null),p.onreadystatechange=function(){if(4===p.readyState&&!f)if(clearTimeout(l),p.status>=200&&p.status<300){var r;r=e.binary?i([p.response||""],{type:p.getResponseHeader("Content-Type")}):p.responseText,n(s,r,p,t)}else n(a,p,t)},e.timeout>0&&(l=setTimeout(c,e.timeout)),p.send(e.body),{abort:c}}return e.json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),r(e,function(r,o,i){if(r)return r.status=o?o.statusCode:400,n(a,r,t);var u=o.headers["content-type"],c=i||"";e.binary||!e.json&&e.processData||"object"==typeof c||!(/json/.test(u)||/^[\s]*\{/.test(c)&&/\}[\s]*$/.test(c))||(c=JSON.parse(c)),o.statusCode>=200&&o.statusCode<300?n(s,c,o,t):(e.binary&&(c=JSON.parse(c.toString())),c.status=o.statusCode,n(t,c))})}var r=e("request"),o=e("./extend.js"),i=e("./blob.js");t.exports=n},{"./blob.js":7,"./extend.js":9,request:1}],7:[function(e,t){function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(n){if("TypeError"!==n.name)throw n;for(var r=window.BlobBuilder||window.MSBlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder,o=new r,i=0;i<e.length;i+=1)o.append(e[i]);return o.getBlob(t.type)}}t.exports=n},{}],8:[function(e,t){t.exports={MISSING_BULK_DOCS:{status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"},MISSING_DOC:{status:404,error:"not_found",reason:"missing"},REV_CONFLICT:{status:409,error:"conflict",reason:"Document update conflict"},INVALID_ID:{status:400,error:"invalid_id",reason:"_id field must contain a string"},MISSING_ID:{status:412,error:"missing_id",reason:"_id is required for puts"},RESERVED_ID:{status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."},NOT_OPEN:{status:412,error:"precondition_failed",reason:"Database not open so cannot close"},UNKNOWN_ERROR:{status:500,error:"unknown_error",reason:"Database encountered an unknown error"},BAD_ARG:{status:500,error:"badarg",reason:"Some query argument is invalid"},INVALID_REQUEST:{status:400,error:"invalid_request",reason:"Request was invalid"},QUERY_PARSE_ERROR:{status:400,error:"query_parse_error",reason:"Some query parameter is invalid"},DOC_VALIDATION:{status:500,error:"doc_validation",reason:"Bad special document member"},BAD_REQUEST:{status:400,error:"bad_request",reason:"Something wrong with the request"},NOT_AN_OBJECT:{status:400,error:"bad_request",reason:"Document must be a JSON object"},DB_MISSING:{status:404,error:"not_found",reason:"Database not found"}}},{}],9:[function(e,t){function n(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?a[l.call(e)]||"object":typeof e}function r(e){return null!==e&&e===e.window}function o(e){if(!e||"object"!==n(e)||e.nodeType||r(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var o;for(o in e);return void 0===o||f.call(e,o)}function i(e){return"function"===n(e)}function s(){var e,t,n,r,a,u,c=arguments[0]||{},d=1,l=arguments.length,f=!1;for("boolean"==typeof c&&(f=c,c=arguments[1]||{},d=2),"object"==typeof c||i(c)||(c={}),l===d&&(c=this,--d);l>d;d++)if(null!=(e=arguments[d]))for(t in e)n=c[t],r=e[t],c!==r&&(f&&r&&(o(r)||(a=p(r)))?(a?(a=!1,u=n&&p(n)?n:[]):u=n&&o(n)?n:{},c[t]=s(f,u,r)):void 0!==r&&(p(e)&&i(r)||(c[t]=r)));return c}for(var a={},u=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],c=0;c<u.length;c++){var d=u[c];a["[object "+d+"]"]=d.toLowerCase()}var l=a.toString,f=a.hasOwnProperty,p=Array.isArray||function(e){return"array"===n(e)};t.exports=s},{}],10:[function(e,t,n){(function(t){var r=e("crypto");n.MD5=function(e){function n(e,t){return e<<t|e>>>32-t}function o(e,t){var n,r,o,i,s;return o=2147483648&e,i=2147483648&t,n=1073741824&e,r=1073741824&t,s=(1073741823&e)+(1073741823&t),n&r?2147483648^s^o^i:n|r?1073741824&s?3221225472^s^o^i:1073741824^s^o^i:s^o^i}function i(e,t,n){return e&t|~e&n}function s(e,t,n){return e&n|t&~n}function a(e,t,n){return e^t^n}function u(e,t,n){return t^(e|~n)}function c(e,t,r,s,a,u,c){return e=o(e,o(o(i(t,r,s),a),c)),o(n(e,u),t)}function d(e,t,r,i,a,u,c){return e=o(e,o(o(s(t,r,i),a),c)),o(n(e,u),t)}function l(e,t,r,i,s,u,c){return e=o(e,o(o(a(t,r,i),s),c)),o(n(e,u),t)}function f(e,t,r,i,s,a,c){return e=o(e,o(o(u(t,r,i),s),c)),o(n(e,a),t)}function p(e){for(var t,n=e.length,r=n+8,o=(r-r%64)/64,i=16*(o+1),s=Array(i-1),a=0,u=0;n>u;)t=(u-u%4)/4,a=u%4*8,s[t]=s[t]|e.charCodeAt(u)<<a,u++;return t=(u-u%4)/4,a=u%4*8,s[t]=s[t]|128<<a,s[i-2]=n<<3,s[i-1]=n>>>29,s}function _(e){var t,n,r="",o="";for(n=0;3>=n;n++)t=e>>>8*n&255,o="0"+t.toString(16),r+=o.substr(o.length-2,2);return r}if(!t.browser)return r.createHash("md5").update(e).digest("hex");var h,v,m,g,y,S,E,b,O,T=Array(),R=7,q=12,k=17,w=22,C=5,D=9,P=14,I=20,A=4,j=11,x=16,N=23,U=6,B=10,M=15,L=21;for(T=p(e),S=1732584193,E=4023233417,b=2562383102,O=271733878,h=0;h<T.length;h+=16)v=S,m=E,g=b,y=O,S=c(S,E,b,O,T[h+0],R,3614090360),O=c(O,S,E,b,T[h+1],q,3905402710),b=c(b,O,S,E,T[h+2],k,606105819),E=c(E,b,O,S,T[h+3],w,3250441966),S=c(S,E,b,O,T[h+4],R,4118548399),O=c(O,S,E,b,T[h+5],q,1200080426),b=c(b,O,S,E,T[h+6],k,2821735955),E=c(E,b,O,S,T[h+7],w,4249261313),S=c(S,E,b,O,T[h+8],R,1770035416),O=c(O,S,E,b,T[h+9],q,2336552879),b=c(b,O,S,E,T[h+10],k,4294925233),E=c(E,b,O,S,T[h+11],w,2304563134),S=c(S,E,b,O,T[h+12],R,1804603682),O=c(O,S,E,b,T[h+13],q,4254626195),b=c(b,O,S,E,T[h+14],k,2792965006),E=c(E,b,O,S,T[h+15],w,1236535329),S=d(S,E,b,O,T[h+1],C,4129170786),O=d(O,S,E,b,T[h+6],D,3225465664),b=d(b,O,S,E,T[h+11],P,643717713),E=d(E,b,O,S,T[h+0],I,3921069994),S=d(S,E,b,O,T[h+5],C,3593408605),O=d(O,S,E,b,T[h+10],D,38016083),b=d(b,O,S,E,T[h+15],P,3634488961),E=d(E,b,O,S,T[h+4],I,3889429448),S=d(S,E,b,O,T[h+9],C,568446438),O=d(O,S,E,b,T[h+14],D,3275163606),b=d(b,O,S,E,T[h+3],P,4107603335),E=d(E,b,O,S,T[h+8],I,1163531501),S=d(S,E,b,O,T[h+13],C,2850285829),O=d(O,S,E,b,T[h+2],D,4243563512),b=d(b,O,S,E,T[h+7],P,1735328473),E=d(E,b,O,S,T[h+12],I,2368359562),S=l(S,E,b,O,T[h+5],A,4294588738),O=l(O,S,E,b,T[h+8],j,2272392833),b=l(b,O,S,E,T[h+11],x,1839030562),E=l(E,b,O,S,T[h+14],N,4259657740),S=l(S,E,b,O,T[h+1],A,2763975236),O=l(O,S,E,b,T[h+4],j,1272893353),b=l(b,O,S,E,T[h+7],x,4139469664),E=l(E,b,O,S,T[h+10],N,3200236656),S=l(S,E,b,O,T[h+13],A,681279174),O=l(O,S,E,b,T[h+0],j,3936430074),b=l(b,O,S,E,T[h+3],x,3572445317),E=l(E,b,O,S,T[h+6],N,76029189),S=l(S,E,b,O,T[h+9],A,3654602809),O=l(O,S,E,b,T[h+12],j,3873151461),b=l(b,O,S,E,T[h+15],x,530742520),E=l(E,b,O,S,T[h+2],N,3299628645),S=f(S,E,b,O,T[h+0],U,4096336452),O=f(O,S,E,b,T[h+7],B,1126891415),b=f(b,O,S,E,T[h+14],M,2878612391),E=f(E,b,O,S,T[h+5],L,4237533241),S=f(S,E,b,O,T[h+12],U,1700485571),O=f(O,S,E,b,T[h+3],B,2399980690),b=f(b,O,S,E,T[h+10],M,4293915773),E=f(E,b,O,S,T[h+1],L,2240044497),S=f(S,E,b,O,T[h+8],U,1873313359),O=f(O,S,E,b,T[h+15],B,4264355552),b=f(b,O,S,E,T[h+6],M,2734768916),E=f(E,b,O,S,T[h+13],L,1309151649),S=f(S,E,b,O,T[h+4],U,4149444226),O=f(O,S,E,b,T[h+11],B,3174756917),b=f(b,O,S,E,T[h+2],M,718787259),E=f(E,b,O,S,T[h+9],L,3951481745),S=o(S,v),E=o(E,m),b=o(b,g),O=o(O,y);var H=_(S)+_(E)+_(b)+_(O);return H.toLowerCase()}}).call(this,e("/Users/tjd/dev/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/tjd/dev/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":2,crypto:1}],11:[function(e,t){function n(e,t){var r,o=n.CHARS,i=[];if(t=t||o.length,e)for(r=0;e>r;r++)i[r]=o[0|Math.random()*t];else{var s;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;36>r;r++)i[r]||(s=0|16*Math.random(),i[r]=o[19==r?3&s|8:s])}return i.join("")}n.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t.exports=n},{}],12:[function(_dereq_,module,exports){"use strict";var pouchCollate=_dereq_("../pouch.collate.js"),MapReduce=function(db){function viewQuery(fun,options){function sum(e){return e.reduce(function(e,t){return e+t},0)}if(options.complete){options.skip||(options.skip=0),fun.reduce||(options.reduce=!1);var builtInReduce={_sum:function(e,t){return sum(t)},_count:function(e,t,n){return n?sum(t):t.length},_stats:function(e,t){return{sum:sum(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(){var e=0;for(var n in t)"number"==typeof t[n]&&(e+=t[n]*t[n]);return e}()}}},results=[],current=null,num_started=0,completed=!1,emit=function(e,t){var n={id:current.doc._id,key:e,value:t};if(!(options.startkey&&pouchCollate(e,options.startkey)<0||options.endkey&&pouchCollate(e,options.endkey)>0||options.key&&0!==pouchCollate(e,options.key))){if(num_started++,options.include_docs){if(t&&"object"==typeof t&&t._id)return void db.get(t._id,function(e,t){t&&(n.doc=t),results.push(n),checkComplete()});n.doc=current.doc}results.push(n)}};eval("fun.map = "+fun.map.toString()+";"),fun.reduce&&(builtInReduce[fun.reduce]&&(fun.reduce=builtInReduce[fun.reduce]),eval("fun.reduce = "+fun.reduce.toString()+";"));var checkComplete=function(){if(completed&&results.length==num_started){if(results.sort(function(e,t){return pouchCollate(e.key,t.key)}),options.descending&&results.reverse(),options.reduce===!1)return options.complete(null,{total_rows:results.length,offset:options.skip,rows:"limit"in options?results.slice(options.skip,options.limit+options.skip):options.skip>0?results.slice(options.skip):results});var e=[];results.forEach(function(t){var n=e[e.length-1]||null;return n&&0===pouchCollate(n.key[0][0],t.key)?(n.key.push([t.key,t.id]),void n.value.push(t.value)):void e.push({key:[[t.key,t.id]],value:[t.value]})}),e.forEach(function(e){e.value=fun.reduce(e.key,e.value),e.value="undefined"==typeof e.value?null:e.value,e.key=e.key[0][0]}),options.complete(null,{total_rows:e.length,offset:options.skip,rows:"limit"in options?e.slice(options.skip,options.limit+options.skip):options.skip>0?e.slice(options.skip):e})}};db.changes({conflicts:!0,include_docs:!0,onChange:function(e){"deleted"in e||(current={doc:e.doc},fun.map.call(this,e.doc))},complete:function(){completed=!0,checkComplete()}})}}function httpQuery(e,t,n){var r=[],o=void 0,i="GET";if("undefined"!=typeof t.reduce&&r.push("reduce="+t.reduce),"undefined"!=typeof t.include_docs&&r.push("include_docs="+t.include_docs),"undefined"!=typeof t.limit&&r.push("limit="+t.limit),"undefined"!=typeof t.descending&&r.push("descending="+t.descending),"undefined"!=typeof t.startkey&&r.push("startkey="+encodeURIComponent(JSON.stringify(t.startkey))),"undefined"!=typeof t.endkey&&r.push("endkey="+encodeURIComponent(JSON.stringify(t.endkey))),"undefined"!=typeof t.key&&r.push("key="+encodeURIComponent(JSON.stringify(t.key))),"undefined"!=typeof t.group&&r.push("group="+t.group),"undefined"!=typeof t.group_level&&r.push("group_level="+t.group_level),"undefined"!=typeof t.skip&&r.push("skip="+t.skip),"undefined"!=typeof t.keys&&(i="POST",o=JSON.stringify({keys:t.keys})),r=r.join("&"),r=""===r?"":"?"+r,"string"==typeof e){var s=e.split("/");return void db.request({method:i,url:"_design/"+s[0]+"/_view/"+s[1]+r,body:o},n)}var a=JSON.parse(JSON.stringify(e,function(e,t){return"function"==typeof t?t+"":t}));db.request({method:"POST",url:"_temp_view"+r,body:a},n)}function query(e,t,n){if("function"==typeof t&&(n=t,t={}),n&&(t.complete=n),"http"===db.type())return"function"==typeof e?httpQuery({map:e},t,n):httpQuery(e,t,n);if("object"==typeof e)return viewQuery(e,t);if("function"==typeof e)return viewQuery({map:e},t);var r=e.split("/");db.get("_design/"+r[0],function(e,o){return e?void(n&&n(e)):o.views[r[1]]?void viewQuery({map:o.views[r[1]].map,reduce:o.views[r[1]].reduce},t):void(n&&n({error:"not_found",reason:"missing_named_view"}))})}return{query:query}};MapReduce._delete=function(){},"undefined"!=typeof module&&module.exports&&(module.exports=MapReduce)},{"../pouch.collate.js":14}],13:[function(e,t){"use strict";function n(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n)===!0)return e[n];return!1}function r(e){return function(t,n){t||n[0].error?u(e,t||n[0]):u(e,null,n[0])}}function o(e){var t={},n=[];return s.traverseRevTree(e,function(e,r,o,i){var s=r+"-"+o;return e&&(t[s]=0),void 0!==i&&n.push({from:i,to:s}),s}),n.reverse(),n.forEach(function(e){t[e.from]=void 0===t[e.from]?1+t[e.to]:Math.min(t[e.from],1+t[e.to])}),t}var i=e("./pouch.utils.js"),s=e("./pouch.merge"),a=e("./deps/errors"),u=i.call;t.exports=function(e){function t(t,c){function d(e){return _?function(t,n){if(t)u(e,t);else{var r=n.length,o=function(){r--,r||u(e,null,n)};n.forEach(function(e){e.ok?l(e.id,1,o):o()})}}:e}function l(e,t,n){p._getRevisionTree(e,function(r,i){if(r)return u(n);var a=o(i),c=[],d=[];Object.keys(a).forEach(function(e){a[e]>t&&c.push(e)}),s.traverseRevTree(i,function(e,t,n,r,o){var i=t+"-"+n;"available"===o.status&&-1!==c.indexOf(i)&&(o.status="missing",d.push(i))}),p._doCompaction(e,i,d,n)})}var f={},p=e.adapters[t.adapter](t,function(n,r){if(n)return void(c&&c(n));for(var o in f)r.hasOwnProperty(o)||(r[o]=f[o]);t.name===e.prefix+e.ALL_DBS?c(n,r):e.open(t,function(e){c(e,r)})}),_=t.auto_compaction===!0;f.post=function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e)?u(n,a.NOT_AN_OBJECT):p.bulkDocs({docs:[e]},t,d(r(n)))},f.put=function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!=typeof e?u(n,a.NOT_AN_OBJECT):"_id"in e?p.bulkDocs({docs:[e]},t,d(r(n))):u(n,a.MISSING_ID)},f.putAttachment=function(e,t,n,r,o,i){function s(e){e._attachments=e._attachments||{},e._attachments[t]={content_type:o,data:r},f.put(e,i)}return f.taskqueue.ready()?("function"==typeof o&&(i=o,o=r,r=n,n=null),"undefined"==typeof o&&(o=r,r=n,n=null),void f.get(e,function(t,r){return t&&t.error===a.MISSING_DOC.error?void s({_id:e}):t?void u(i,t):r._rev!==n?void u(i,a.REV_CONFLICT):void s(r)})):void f.taskqueue.addTask("putAttachment",arguments)},f.removeAttachment=function(e,t,n,r){f.get(e,function(e,o){return e?void u(r,e):o._rev!==n?void u(r,a.REV_CONFLICT):o._attachments?(delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,void f.put(o,r)):u(r,null)})},f.remove=function(e,t,n){"function"==typeof t&&(n=t,t={}),void 0===t&&(t={}),t.was_delete=!0;var o={_id:e._id,_rev:e._rev};return o._deleted=!0,p.bulkDocs({docs:[o]},t,r(n))},f.revsDiff=function(e,t,n){function r(e,t){c[e]||(c[e]={missing:[]}),c[e].missing.push(t)}function o(t,n){var o=e[t].slice(0);s.traverseRevTree(n,function(e,n,i,s,a){var u=n+"-"+i,c=o.indexOf(u);-1!==c&&(o.splice(c,1),"available"!==a.status&&r(t,u))}),o.forEach(function(e){r(t,e)})}"function"==typeof t&&(n=t,t={});var i=Object.keys(e),a=0,c={};i.map(function(t){p._getRevisionTree(t,function(r,s){if(r&&"not_found"===r.error&&"missing"===r.reason)c[t]={missing:e[t]};else{if(r)return u(n,r);o(t,s)}return++a===i.length?u(n,null,c):void 0})})},f.compact=function(e,t){"function"==typeof e&&(t=e,e={}),f.changes({complete:function(e,n){if(e)return void u(t);var r=n.results.length;return r?void n.results.forEach(function(e){l(e.id,0,function(){r--,r||u(t)})}):void u(t)}})},f.get=function(e,t,r){function o(){var n=[],o=c.length;return o?void c.forEach(function(i){f.get(e,{rev:i,revs:t.revs},function(e,t){n.push(e?{missing:i}:{ok:t}),o--,o||u(r,null,n)})}):u(r,null,n)}if(!f.taskqueue.ready())return void f.taskqueue.addTask("get",arguments);"function"==typeof t&&(r=t,t={});var c=[];{if(!t.open_revs)return p._get(e,t,function(e,o){if(e)return u(r,e);var i=o.doc,a=o.metadata,c=o.ctx;if(t.conflicts){var d=s.collectConflicts(a);d.length&&(i._conflicts=d)}if(t.revs||t.revs_info){var l=s.rootToLeaf(a.rev_tree),f=n(l,function(e){return-1!==e.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])});if(f.ids.splice(f.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])+1),f.ids.reverse(),t.revs&&(i._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map(function(e){return e.id})}),t.revs_info){var _=f.pos+f.ids.length;i._revs_info=f.ids.map(function(e){return _--,{rev:_+"-"+e.id,status:e.opts.status}})}}if(t.local_seq&&(i._local_seq=o.metadata.seq),t.attachments&&i._attachments){var h=i._attachments,v=Object.keys(h).length;if(0===v)return u(r,null,i);Object.keys(h).forEach(function(e){p._getAttachment(h[e],{encode:!0,ctx:c},function(t,n){i._attachments[e].data=n,--v||u(r,null,i)})})}else{if(i._attachments)for(var m in i._attachments)i._attachments[m].stub=!0;u(r,null,i)}});if("all"===t.open_revs)p._getRevisionTree(e,function(e,t){e&&(t=[]),c=s.collectLeaves(t).map(function(e){return e.rev}),o()});else{if(!Array.isArray(t.open_revs))return u(r,i.error(a.UNKNOWN_ERROR,"function_clause"));c=t.open_revs;for(var d=0;d<c.length;d++){var l=c[d];if("string"!=typeof l||!/^\d+-/.test(l))return u(r,i.error(a.BAD_REQUEST,"Invalid rev format"))}o()}}},f.getAttachment=function(e,t,n,r){return f.taskqueue.ready()?(n instanceof Function&&(r=n,n={}),void p._get(e,n,function(e,o){return e?u(r,e):o.doc._attachments&&o.doc._attachments[t]?(n.ctx=o.ctx,void p._getAttachment(o.doc._attachments[t],n,r)):u(r,a.MISSING_DOC)})):void f.taskqueue.addTask("getAttachment",arguments)},f.allDocs=function(e,t){if(!f.taskqueue.ready())return void f.taskqueue.addTask("allDocs",arguments);if("function"==typeof e&&(t=e,e={}),"keys"in e){if("startkey"in e)return void u(t,i.error(a.QUERY_PARSE_ERROR,"Query parameter `start_key` is not compatible with multi-get"));if("endkey"in e)return void u(t,i.error(a.QUERY_PARSE_ERROR,"Query parameter `end_key` is not compatible with multi-get"))}return"undefined"==typeof e.skip&&(e.skip=0),p._allDocs(e,t)},f.changes=function(t){if(!f.taskqueue.ready()){var n=f.taskqueue.addTask("changes",arguments);return{cancel:function(){return n.task?n.task.cancel():(e.DEBUG,void(n.parameters[0].aborted=!0))}}}if(t=i.extend(!0,{},t),t.since||(t.since=0),"latest"===t.since){var r;return f.info(function(e,n){t.aborted||(t.since=n.update_seq-1,f.changes(t))}),{cancel:function(){return r?r.cancel():(e.DEBUG,void(t.aborted=!0))}}}return"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,p._changes(t)},f.close=function(e){return f.taskqueue.ready()?p._close(e):void f.taskqueue.addTask("close",arguments)},f.info=function(e){return f.taskqueue.ready()?p._info(e):void f.taskqueue.addTask("info",arguments)},f.id=function(){return p._id()},f.type=function(){return"function"==typeof p._type?p._type():t.adapter},f.bulkDocs=function(e,t,n){if(!f.taskqueue.ready())return void f.taskqueue.addTask("bulkDocs",arguments);if("function"==typeof t&&(n=t,t={}),t=t?i.extend(!0,{},t):{},!e||!e.docs||e.docs.length<1)return u(n,a.MISSING_BULK_DOCS);if(!Array.isArray(e.docs))return u(n,a.QUERY_PARSE_ERROR);for(var r=0;r<e.docs.length;++r)if("object"!=typeof e.docs[r]||Array.isArray(e.docs[r]))return u(n,a.NOT_AN_OBJECT);return e=i.extend(!0,{},e),"new_edits"in t||(t.new_edits=!0),p._bulkDocs(e,t,d(n))};var h={};h.ready=!1,h.queue=[],f.taskqueue={},f.taskqueue.execute=function(e){h.ready&&h.queue.forEach(function(t){t.task=e[t.name].apply(null,t.parameters)})},f.taskqueue.ready=function(){return 0===arguments.length?h.ready:void(h.ready=arguments[0])},f.taskqueue.addTask=function(e,t){var n={name:e,parameters:t};return h.queue.push(n),n},f.replicate={},f.replicate.from=function(t,n,r){return"function"==typeof n&&(r=n,n={}),e.replicate(t,p,n,r)},f.replicate.to=function(t,n,r){return"function"==typeof n&&(r=n,n={}),e.replicate(p,t,n,r)};for(var v in f)p.hasOwnProperty(v)||(p[v]=f[v]);return t.skipSetup&&(f.taskqueue.ready(!0),f.taskqueue.execute(f)),i.isCordova()&&cordova.fireWindowEvent(t.name+"_pouch",{}),p}return t}},{"./deps/errors":8,"./pouch.merge":16,"./pouch.utils.js":18}],14:[function(e,t){"use strict";function n(e,t){var n=s(e),a=s(t);return n-a!==0?n-a:null===e?0:"number"==typeof e?e-t:"boolean"==typeof e?t>e?-1:1:"string"==typeof e?r(e,t):Array.isArray(e)?i(e,t):"object"==typeof e?o(e,t):void 0}function r(e,t){return e===t?0:e>t?1:-1}function o(e,t){for(var r=Object.keys(e),o=Object.keys(t),i=Math.min(r.length,o.length),s=0;i>s;s++){var a=n(r[s],o[s]);if(0!==a)return a;if(a=n(e[r[s]],t[o[s]]),0!==a)return a}return r.length===o.length?0:r.length>o.length?1:-1}function i(e,t){for(var r=Math.min(e.length,t.length),o=0;r>o;o++){var i=n(e[o],t[o]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}function s(e){var t=["boolean","number","string","object"];return-1!==t.indexOf(typeof e)?null===e?1:t.indexOf(typeof e)+2:Array.isArray(e)?4.5:void 0}t.exports=n},{}],15:[function(e,t){(function(n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);("function"==typeof t||"undefined"==typeof t)&&(n=t,t={}),"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof n&&(n=function(){});var o=r.parseAdapter(t.name||e);if(t.originalName=e,t.name=t.name||o.name,t.adapter=t.adapter||o.adapter,!r.adapters[t.adapter])throw"Adapter is missing";if(!r.adapters[t.adapter].valid())throw"Invalid Adapter";var s=new i(t,function(e,t){if(e)return void(n&&n(e));for(var o in r.plugins){var i=r.plugins[o](t);for(var s in i)s in t||(t[s]=i[s])}t.taskqueue.ready(!0),t.taskqueue.execute(t),n(null,t)});for(var a in s)this[a]=s[a];for(var u in r.plugins){var c=r.plugins[u](this);for(var d in c)d in this||(this[d]=c[d])}}var o=e("./pouch.utils.js"),i=e("./pouch.adapter.js")(r);r.adapters={},r.plugins={},r.prefix="_pouch_",r.parseAdapter=function(e){var t,n=e.match(/([a-z\-]*):\/\/(.*)/);if(n){if(e=/http(s?)/.test(n[1])?n[1]+"://"+n[2]:n[2],t=n[1],!r.adapters[t].valid())throw"Invalid adapter";return{name:e,adapter:n[1]}}for(var o=["idb","leveldb","websql"],i=0;i<o.length;++i)if(o[i]in r.adapters){t=r.adapters[o[i]];var s="use_prefix"in t?t.use_prefix:!0;return{name:s?r.prefix+e:e,adapter:o[i]}}throw"No valid adapter found"},r.destroy=function(e,t,n){("function"==typeof t||"undefined"==typeof t)&&(n=t,t={}),"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof n&&(n=function(){});var o=r.parseAdapter(t.name||e),i=function(e){if(e)return void n(e);for(var i in r.plugins)r.plugins[i]._delete(o.name);r.adapters[o.adapter].destroy(o.name,t,n)};r.removeFromAllDbs(o,i)},r.removeFromAllDbs=function(e,t){if(!r.enableAllDbs)return void t();var n=e.adapter;return"http"===n||"https"===n?void t():void new r(r.allDBName(e.adapter),function(n,o){if(n)return void t();var i=r.dbName(e.adapter,e.name);o.get(i,function(e,n){e?t():o.remove(n,function(e){t()})})})},r.adapter=function(e,t){t.valid()&&(r.adapters[e]=t)},r.plugin=function(e,t){r.plugins[e]=t},r.enableAllDbs=!1,r.ALL_DBS="_allDbs",r.dbName=function(e,t){return[e,"-",t].join("")},r.realDBName=function(e,t){return[e,"://",t].join("")},r.allDBName=function(e){return[e,"://",r.prefix+r.ALL_DBS].join("")},r.open=function(e,t){if(!r.enableAllDbs)return void t();var n=e.adapter;return"http"===n||"https"===n?void t():void new r(r.allDBName(n),function(o,i){if(o)return void t();var s=r.dbName(n,e.name);i.get(s,function(n){n&&404===n.status?i.put({_id:s,dbname:e.originalName},function(e){t()}):t()})})},r.allDbs=function(e){var t=function(n,o){if(0===n.length){var i=[];return o.forEach(function(e){var t=i.some(function(t){return t.id===e.id});t||i.push(e)}),void e(null,i.map(function(e){return e.doc.dbname}))}var s=n.shift();return"http"===s||"https"===s?void t(n,o):void new r(r.allDBName(s),function(r,i){return r?void e(r):void i.allDocs({include_docs:!0},function(r,i){return r?void e(r):(o.unshift.apply(o,i.rows),void t(n,o))})})},n=Object.keys(r.adapters);t(n,[])},t.exports=r,r.ajax=e("./deps/ajax"),r.extend=e("./deps/extend"),r.utils=o,r.Errors=e("./deps/errors"),r.replicate=e("./pouch.replicate.js").replicate,r.version=e("./version");var s=e("./adapters/pouch.http.js");if(r.adapter("http",s),r.adapter("https",s),r.adapter("idb",e("./adapters/pouch.idb.js")),r.adapter("websql",e("./adapters/pouch.websql.js")),r.plugin("mapreduce",e("./plugins/pouchdb.mapreduce.js")),!n.browser){var a=e("./adapters/pouch.leveldb.js");r.adapter("ldb",a),r.adapter("leveldb",a)}}).call(this,e("/Users/tjd/dev/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./adapters/pouch.http.js":3,"./adapters/pouch.idb.js":4,"./adapters/pouch.leveldb.js":1,"./adapters/pouch.websql.js":5,"./deps/ajax":6,"./deps/errors":8,"./deps/extend":9,"./plugins/pouchdb.mapreduce.js":12,"./pouch.adapter.js":13,"./pouch.replicate.js":17,"./pouch.utils.js":18,"./version":19,"/Users/tjd/dev/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":2}],16:[function(e,t){"use strict";function n(e){for(var t,n=e.shift(),r=[n.id,n.opts,[]],o=r;e.length;)n=e.shift(),t=[n.id,n.opts,[]],o[2].push(t),o=t;return r}function r(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var o=n.pop(),i=o.tree1,s=o.tree2;(i[1].status||s[1].status)&&(i[1].status="available"===i[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(i[2][0]){for(var u=!1,c=0;c<i[2].length;c++)i[2][c][0]===s[2][a][0]&&(n.push({tree1:i[2][c],tree2:s[2][a]}),u=!0);u||(r="new_branch",i[2].push(s[2][a]),i[2].sort())}else r="new_leaf",i[2][0]=s[2][a]}return{conflicts:r,tree:e}}function o(e,t,n){var o,i=[],s=!1,a=!1;return e.length?(e.forEach(function(e){if(e.pos===t.pos&&e.ids[0]===t.ids[0])o=r(e.ids,t.ids),i.push({pos:e.pos,ids:o.tree}),s=s||o.conflicts,a=!0;else if(n!==!0){var u=e.pos<t.pos?e:t,c=e.pos<t.pos?t:e,d=c.pos-u.pos,l=[],f=[];for(f.push({ids:u.ids,diff:d,parent:null,parentIdx:null});f.length>0;){var p=f.pop();0!==p.diff?p.ids&&p.ids[2].forEach(function(e,t){f.push({ids:e,diff:p.diff-1,parent:p.ids,parentIdx:t})}):p.ids[0]===c.ids[0]&&l.push(p)}var _=l[0];_?(o=r(_.ids,c.ids),_.parent[2][_.parentIdx]=o.tree,i.push({pos:u.pos,ids:u.ids}),s=s||o.conflicts,a=!0):i.push(e)}else i.push(e)}),a||i.push(t),i.sort(function(e,t){return e.pos-t.pos}),{tree:i,conflicts:s||"internal_node"}):{tree:[t],conflicts:"new_leaf"}}function i(e,t){var r=a.rootToLeaf(e).map(function(e){var r=e.ids.slice(-t);return{pos:e.pos+(e.ids.length-r.length),ids:n(r)}});return r.reduce(function(e,t){return o(e,t,!0).tree},[r.shift()])}var s=e("./deps/extend"),a={};a.merge=function(e,t,n){e=s(!0,[],e),t=s(!0,{},t);var r=o(e,t);return{tree:i(r.tree,n),conflicts:r.conflicts}},a.winningRev=function(e){var t=[];return a.traverseRevTree(e.rev_tree,function(e,n,r,o,i){e&&t.push({pos:n,id:r,deleted:!!i.deleted})}),t.sort(function(e,t){return e.deleted!==t.deleted?e.deleted>t.deleted?1:-1:e.pos!==t.pos?t.pos-e.pos:e.id<t.id?1:-1}),t[0].pos+"-"+t[0].id},a.traverseRevTree=function(e,t){var n=[];for(e.forEach(function(e){n.push({pos:e.pos,ids:e.ids})});n.length>0;){var r=n.pop(),o=r.pos,i=r.ids,s=t(0===i[2].length,o,i[0],r.ctx,i[1]);i[2].forEach(function(e){n.push({pos:o+1,ids:e,ctx:s})})}},a.collectLeaves=function(e){var t=[];return a.traverseRevTree(e,function(e,n,r,o,i){e&&t.unshift({rev:n+"-"+r,pos:n,opts:i})}),t.sort(function(e,t){return t.pos-e.pos}),t.map(function(e){delete e.pos}),t},a.collectConflicts=function(e){var t=a.winningRev(e),n=a.collectLeaves(e.rev_tree),r=[];return n.forEach(function(e){e.rev===t||e.opts.deleted||r.push(e.rev)}),r},a.rootToLeaf=function(e){var t=[];return a.traverseRevTree(e,function(e,n,r,o,i){if(o=o?o.slice(0):[],o.push({id:r,opts:i}),e){var s=n+1-o.length;t.unshift({pos:s,ids:o})}return o}),t},t.exports=a},{"./deps/extend":9}],17:[function(e,t,n){"use strict";function r(){var e=this;this.cancelled=!1,this.cancel=function(){e.cancelled=!0}}function o(e){var t=[],n={},r=!1;
return n.enqueue=function(e,o){t.push({fun:e,args:o}),r||n.process()},n.process=function(){if(!r&&t.length&&!e.cancelled){r=!0;var n=t.shift();n.fun.apply(null,n.args)}},n.notifyRequestComplete=function(){r=!1,n.process()},n}function i(e,t,n){var r=n.filter?n.filter.toString():"";return"_local/"+d.Crypto.MD5(e.id()+t.id()+r)}function s(e,t,n,r){t.get(n,function(t,o){t&&404===t.status?r(null,0):e.get(n,function(e,t){e&&404===e.status||o.last_seq!==t.last_seq?r(null,0):r(null,t.last_seq)})})}function a(e,t,n,r,o){function i(e,t){e.get(n,function(o,i){o&&404===o.status&&(i={_id:n}),i.last_seq=r,e.put(i,t)})}i(t,function(){i(e,function(){o()})})}function u(e,t,n,r){function u(r,o,i){if(n.onChange)for(var s=0;i>s;s++)n.onChange.apply(this,[q]);b-=i,q.docs_written+=i,a(e,t,y,O,function(){m.notifyRequestComplete(),v()})}function c(){if(!g.length)return m.notifyRequestComplete();var e=g.length;t.bulkDocs({docs:g},{new_edits:!1},function(t,n){u(t,n,e)}),g=[]}function l(t,n){e.get(t,{revs:!0,rev:n,attachments:!0},function(e,t){q.docs_read++,m.notifyRequestComplete(),g.push(t),m.enqueue(c)})}function f(e){return function(t,o){if(m.notifyRequestComplete(),t)return T&&r.cancel(),void d.call(n.complete,t,null);if(0===Object.keys(o).length){for(var i in e)b-=e[i];return void v()}var s=function(e){m.enqueue(l,[a,e])};for(var a in o){var u=e[a]-o[a].missing.length;b-=u,o[a].missing.forEach(s)}}}function p(e,n){t.revsDiff(e,f(n))}function _(e){O=e.seq,S.push(e);var t={};t[e.id]=e.changes.map(function(e){return e.rev});var n={};n[e.id]=e.changes.length,b+=e.changes.length,m.enqueue(p,[t,n])}function h(){E=!0,v()}function v(){E&&0===b&&(q.end_time=new Date,d.call(n.complete,null,q))}var m=new o(r),g=[],y=i(e,t,n),S=[],E=!1,b=0,O=0,T=n.continuous||!1,R=n.doc_ids,q={ok:!0,start_time:new Date,docs_read:0,docs_written:0};s(e,t,y,function(t,o){if(t)return d.call(n.complete,t);if(O=o,!r.cancelled){var i={continuous:T,since:O,style:"all_docs",onChange:_,complete:h,doc_ids:R};n.filter&&(i.filter=n.filter),n.query_params&&(i.query_params=n.query_params);var s=e.changes(i);if(n.continuous){var a=r.cancel;r.cancel=function(){a(),s.cancel()}}}})}function c(e,t){return"string"==typeof e?new l(e,t):void t(null,e)}var d=e("./pouch.utils.js"),l=e("./pouch");n.replicate=function(e,t,n,o){n instanceof Function&&(o=n,n={}),void 0===n&&(n={}),n.complete||(n.complete=o);var i=new r;return c(e,function(e,r){return e?d.call(o,e):void c(t,function(e,t){if(e)return d.call(o,e);if(n.server){if("function"!=typeof r.replicateOnServer)return d.call(o,{error:"Server replication not supported for "+r.type()+" adapter"});if(r.type()!==t.type())return d.call(o,{error:"Server replication for different adapter types ("+r.type()+" and "+t.type()+") is not supported"});r.replicateOnServer(t,n,i)}else u(r,t,n,i)})}),i}},{"./pouch":15,"./pouch.utils.js":18}],18:[function(e,t){function n(e){return/^_/.test(e)?/^_(design|local)/.test(e):!0}function r(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}var o={},i=e("./pouch.merge.js");o.extend=e("./deps/extend"),o.ajax=e("./deps/ajax"),o.createBlob=e("./deps/blob");var s=e("./deps/uuid");o.Crypto=e("./deps/md5.js");var a=e("./deps/buffer"),u=e("./deps/errors");o.error=function(e,t){return o.extend({},e,{reason:t})};var c=["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree"];o.uuids=function(e,t){"object"!=typeof t&&(t={});for(var n=t.length,r=t.radix,o=[];o.push(s(n,r))<e;);return o},o.uuid=function(e){return o.uuids(1,e)[0]},o.call=function(e){if(typeof e==typeof Function){var t=Array.prototype.slice.call(arguments,1);e.apply(this,t)}},o.isLocalId=function(e){return/^_local/.test(e)},o.isDeleted=function(e,t){t||(t=i.winningRev(e)),t.indexOf("-")>=0&&(t=t.split("-")[1]);var n=!1;return i.traverseRevTree(e.rev_tree,function(e,r,o,i,s){o===t&&(n=!!s.deleted)}),n},o.filterChange=function(e){return function(t){var n={},r=e.filter&&"function"==typeof e.filter;if(n.query=e.query_params,e.filter&&r&&!e.filter.call(this,t.doc,n))return!1;if(e.doc_ids&&-1===e.doc_ids.indexOf(t.id))return!1;if(e.include_docs)for(var o in t.doc._attachments)t.doc._attachments[o].stub=!0;else delete t.doc;return!0}},o.processChanges=function(e,t,n){t=t.filter(o.filterChange(e)),e.limit&&e.limit<t.length&&(t.length=e.limit),t.forEach(function(t){o.call(e.onChange,t)}),o.call(e.complete,null,{results:t,last_seq:n})},o.parseDoc=function(e,t){var r,i,s,a=null,d={status:"available"};if(e._deleted&&(d.deleted=!0),t)if(e._id||(e._id=o.uuid()),i=o.uuid({length:32,radix:16}).toLowerCase(),e._rev){if(s=/^(\d+)-(.+)$/.exec(e._rev),!s)throw"invalid value for property '_rev'";e._rev_tree=[{pos:parseInt(s[1],10),ids:[s[2],{status:"missing"},[[i,d,[]]]]}],r=parseInt(s[1],10)+1}else e._rev_tree=[{pos:1,ids:[i,d,[]]}],r=1;else if(e._revisions&&(e._rev_tree=[{pos:e._revisions.start-e._revisions.ids.length+1,ids:e._revisions.ids.reduce(function(e,t){return null===e?[t,d,[]]:[t,{status:"missing"},[e]]},null)}],r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if(s=/^(\d+)-(.+)$/.exec(e._rev),!s)return u.BAD_ARG;r=parseInt(s[1],10),i=s[2],e._rev_tree=[{pos:parseInt(s[1],10),ids:[s[2],d,[]]}]}"string"!=typeof e._id?a=u.INVALID_ID:n(e._id)||(a=u.RESERVED_ID);for(var l in e)e.hasOwnProperty(l)&&"_"===l[0]&&-1===c.indexOf(l)&&(a=o.extend({},u.DOC_VALIDATION),a.reason+=": "+l);return e._id=decodeURIComponent(e._id),e._rev=[r,i].join("-"),a?a:Object.keys(e).reduce(function(t,n){return/^_/.test(n)&&"_attachments"!==n?t.metadata[n.slice(1)]=e[n]:t.data[n]=e[n],t},{metadata:{},data:{}})},o.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},o.Changes=function(){var e={},t={};return r()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.notify(t.db_name.newValue)}):"undefined"!=typeof window&&window.addEventListener("storage",function(t){e.notify(t.key)}),e.addListener=function(e,n,r,o){t[e]||(t[e]={}),t[e][n]={db:r,opts:o}},e.removeListener=function(e,n){t[e]&&delete t[e][n]},e.clearListeners=function(e){delete t[e]},e.notifyLocalWindows=function(e){r()?chrome.storage.local.set({db_name:e}):localStorage[e]="a"===localStorage[e]?"b":"a"},e.notify=function(e){t[e]&&Object.keys(t[e]).forEach(function(n){var r=t[e][n].opts;t[e][n].db.changes({include_docs:r.include_docs,conflicts:r.conflicts,continuous:!1,descending:!1,filter:r.filter,since:r.since,query_params:r.query_params,onChange:function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,o.call(r.onChange,e))}})})},e},o.atob="undefined"!=typeof window&&"atob"in window?function(e){return atob(e)}:function(e){var t=new a(e,"base64");if(t.toString("base64")!==e)throw"Cannot base64 encode full string";return t.toString("binary")},o.btoa="undefined"!=typeof window&&"btoa"in window?function(e){return btoa(e)}:function(e){return new a(e,"binary").toString("base64")},t.exports=o},{"./deps/ajax":6,"./deps/blob":7,"./deps/buffer":1,"./deps/errors":8,"./deps/extend":9,"./deps/md5.js":10,"./deps/uuid":11,"./pouch.merge.js":16}],19:[function(e,t){t.exports="nightly"},{}]},{},[15])(15)});